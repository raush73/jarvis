<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UI-16: Candidate Profile</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.5;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 1.5rem; margin-bottom: 8px; color: #1a1a1a; }
    .subtitle { color: #666; margin-bottom: 20px; font-size: 0.95rem; }

    /* Tab navigation */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      border-bottom: 2px solid #e5e5e5;
      margin-bottom: 20px;
    }
    .tab-btn {
      padding: 10px 16px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      color: #666;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: color 0.15s, border-color 0.15s;
    }
    .tab-btn:hover { color: #333; }
    .tab-btn.active {
      color: #111827;
      border-bottom-color: #111827;
      font-weight: 600;
    }

    /* Tab content */
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .card-title { font-size: 1rem; font-weight: 600; margin-bottom: 12px; color: #1a1a1a; }

    /* Meta rows */
    .meta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    .meta-item label { font-weight: 600; font-size: 0.8rem; color: #555; display: block; margin-bottom: 2px; }
    .meta-item span { font-size: 0.95rem; color: #1a1a1a; }

    /* Tables */
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { text-align: left; padding: 10px 12px; border-bottom: 1px solid #eee; }
    th { background: #fafafa; font-weight: 600; font-size: 0.8rem; color: #555; text-transform: uppercase; }
    td { font-size: 0.9rem; }
    tr:last-child td { border-bottom: none; }

    .empty-state { color: #888; font-style: italic; padding: 20px 0; text-align: center; }

    /* Status badges */
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .badge-pass { background: #d1fae5; color: #065f46; }
    .badge-fail { background: #fee2e2; color: #b91c1c; }
    .badge-unknown { background: #fef3c7; color: #92400e; }
    .badge-ready { background: #d1fae5; color: #065f46; }
    .badge-blocked { background: #fee2e2; color: #b91c1c; }

    /* Readiness gates */
    .gate-section { margin-bottom: 16px; }
    .gate-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .gate-title { font-weight: 600; font-size: 0.95rem; }
    .gate-reasons { margin-left: 20px; }
    .gate-reasons li { color: #666; font-size: 0.9rem; margin-bottom: 4px; }

    /* Compliance row */
    .compliance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }
    .compliance-item {
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 12px;
    }
    .compliance-item label { font-weight: 600; font-size: 0.8rem; color: #555; display: block; margin-bottom: 4px; }
    .compliance-item span { font-size: 0.9rem; color: #666; }

    /* Placeholder sections */
    .placeholder-box {
      background: #fafafa;
      border: 1px dashed #ddd;
      border-radius: 6px;
      padding: 40px 20px;
      text-align: center;
      color: #888;
      font-style: italic;
    }

    .error-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .tabs { gap: 2px; }
      .tab-btn { padding: 8px 10px; font-size: 0.8rem; }
      .meta-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>UI-16: Candidate Profile</h1>
    <p class="subtitle">Recruiter view — Candidate ID: <strong id="headerCandidateId">—</strong></p>

    <div class="error-box" id="errorBox" style="display: none;">
      <strong>Error:</strong> <span id="errorMessage"></span>
    </div>

    <div id="mainContent">
      <!-- Tab Navigation -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="snapshot">Snapshot</button>
        <button class="tab-btn" data-tab="fit">Fit</button>
        <button class="tab-btn" data-tab="readiness">Readiness</button>
        <button class="tab-btn" data-tab="certifications">Certifications</button>
        <button class="tab-btn" data-tab="compliance">Compliance</button>
        <button class="tab-btn" data-tab="notes">Notes & History</button>
        <button class="tab-btn" data-tab="documents">Documents</button>
      </div>

      <!-- TAB 1: Snapshot -->
      <div class="tab-content active" id="tab-snapshot">
        <div class="card">
          <div class="card-title">At-a-Glance</div>
          <div class="meta-grid">
            <div class="meta-item">
              <label>Candidate ID</label>
              <span id="snapshotId">—</span>
            </div>
            <div class="meta-item">
              <label>Status</label>
              <span id="snapshotStatus">—</span>
            </div>
            <div class="meta-item">
              <label>Phone</label>
              <span id="snapshotPhone">—</span>
            </div>
            <div class="meta-item">
              <label>Email</label>
              <span id="snapshotEmail">—</span>
            </div>
            <div class="meta-item">
              <label>Created</label>
              <span id="snapshotCreated">—</span>
            </div>
            <div class="meta-item">
              <label>Last Updated</label>
              <span id="snapshotUpdated">—</span>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 2: Fit -->
      <div class="tab-content" id="tab-fit">
        <div class="card">
          <div class="card-title">Trades</div>
          <table id="tradesTable">
            <thead>
              <tr>
                <th>Trade</th>
                <th>Proficiency</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="tradesBody">
              <tr><td colspan="4" class="empty-state">No trades on file.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="card">
          <div class="card-title">Tools</div>
          <table id="toolsTable">
            <thead>
              <tr>
                <th>Tool</th>
                <th>Status</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="toolsBody">
              <tr><td colspan="4" class="empty-state">No tools on file.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="card">
          <div class="card-title">PPE</div>
          <table id="ppeTable">
            <thead>
              <tr>
                <th>PPE Item</th>
                <th>Status</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="ppeBody">
              <tr><td colspan="4" class="empty-state">No PPE on file.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- TAB 3: Readiness -->
      <div class="tab-content" id="tab-readiness">
        <div class="card">
          <div class="card-title">Dispatch Readiness Summary</div>
          <div style="margin-bottom: 16px;">
            <strong>Overall Status: </strong>
            <span class="badge" id="readinessOverall">—</span>
          </div>

          <div class="gate-section">
            <div class="gate-header">
              <span class="gate-title">Hard Block Gate</span>
              <span class="badge" id="hardBlockStatus">—</span>
            </div>
            <ul class="gate-reasons" id="hardBlockReasons"></ul>
          </div>

          <div class="gate-section">
            <div class="gate-header">
              <span class="gate-title">Certification Gate</span>
              <span class="badge" id="certGateStatus">—</span>
            </div>
            <ul class="gate-reasons" id="certGateReasons"></ul>
          </div>

          <div class="gate-section">
            <div class="gate-header">
              <span class="gate-title">Compliance Gate</span>
              <span class="badge" id="complianceGateStatus">—</span>
            </div>
            <ul class="gate-reasons" id="complianceGateReasons"></ul>
          </div>
        </div>
      </div>

      <!-- TAB 4: Certifications -->
      <div class="tab-content" id="tab-certifications">
        <div class="card">
          <div class="card-title">Certifications</div>
          <table id="certsTable">
            <thead>
              <tr>
                <th>Certification</th>
                <th>Code</th>
                <th>Status</th>
                <th>Verification</th>
                <th>Issued</th>
                <th>Expires</th>
              </tr>
            </thead>
            <tbody id="certsBody">
              <tr><td colspan="6" class="empty-state">No certifications on file.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- TAB 5: Compliance -->
      <div class="tab-content" id="tab-compliance">
        <div class="card">
          <div class="card-title">Compliance Status</div>
          <div class="compliance-grid">
            <div class="compliance-item">
              <label>I-9 Status</label>
              <span id="complianceI9">Not available</span>
            </div>
            <div class="compliance-item">
              <label>W-4 Status</label>
              <span id="complianceW4">Not available</span>
            </div>
            <div class="compliance-item">
              <label>Background Check</label>
              <span id="complianceBackground">Not available</span>
            </div>
            <div class="compliance-item">
              <label>Drug Screen</label>
              <span id="complianceDrug">Not available</span>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 6: Notes & History -->
      <div class="tab-content" id="tab-notes">
        <div class="card">
          <div class="card-title">Notes & History</div>
          <div class="placeholder-box" id="notesPlaceholder">No notes available</div>
          <div id="notesList" style="display: none;"></div>
        </div>
      </div>

      <!-- TAB 7: Documents -->
      <div class="tab-content" id="tab-documents">
        <div class="card">
          <div class="card-title">Documents</div>
          <div class="placeholder-box" id="documentsPlaceholder">No documents available</div>
          <div id="documentsList" style="display: none;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      var data = window.__DATA__;

      // Tab switching
      var tabBtns = document.querySelectorAll('.tab-btn');
      var tabContents = document.querySelectorAll('.tab-content');

      tabBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var targetTab = btn.getAttribute('data-tab');
          tabBtns.forEach(function(b) { b.classList.remove('active'); });
          tabContents.forEach(function(c) { c.classList.remove('active'); });
          btn.classList.add('active');
          document.getElementById('tab-' + targetTab).classList.add('active');
        });
      });

      if (!data) {
        document.getElementById('errorBox').style.display = 'block';
        document.getElementById('errorMessage').textContent = 'No data loaded. Provide ?candidateId=<id> parameter.';
        document.getElementById('mainContent').style.display = 'none';
        return;
      }

      if (data.ok === false) {
        document.getElementById('errorBox').style.display = 'block';
        document.getElementById('errorMessage').textContent = data.reason || data.errorId || 'Unknown error';
        document.getElementById('mainContent').style.display = 'none';
        return;
      }

      // Header
      document.getElementById('headerCandidateId').textContent = data.candidateId || '—';

      // TAB 1: Snapshot
      if (data.snapshot) {
        document.getElementById('snapshotId').textContent = data.snapshot.id || '—';
        document.getElementById('snapshotStatus').textContent = data.snapshot.status || '—';
        document.getElementById('snapshotPhone').textContent = data.snapshot.phone || '—';
        document.getElementById('snapshotEmail').textContent = data.snapshot.email || '—';
        document.getElementById('snapshotCreated').textContent = data.snapshot.createdAt ? data.snapshot.createdAt.slice(0, 10) : '—';
        document.getElementById('snapshotUpdated').textContent = data.snapshot.updatedAt ? data.snapshot.updatedAt.slice(0, 10) : '—';
      }

      // TAB 2: Fit
      if (data.fit) {
        // Trades
        if (data.fit.trades && data.fit.trades.length > 0) {
          var tradesHtml = '';
          data.fit.trades.forEach(function(t) {
            tradesHtml += '<tr><td>' + esc(t.tradeName) + '</td><td>' + esc(t.proficiency) + '</td><td>' + esc(t.source) + '</td><td>' + esc(t.notes || '—') + '</td></tr>';
          });
          document.getElementById('tradesBody').innerHTML = tradesHtml;
        }

        // Tools
        if (data.fit.tools && data.fit.tools.length > 0) {
          var toolsHtml = '';
          data.fit.tools.forEach(function(t) {
            toolsHtml += '<tr><td>' + esc(t.toolName) + '</td><td>' + esc(t.status) + '</td><td>' + esc(t.source) + '</td><td>' + esc(t.notes || '—') + '</td></tr>';
          });
          document.getElementById('toolsBody').innerHTML = toolsHtml;
        }

        // PPE
        if (data.fit.ppe && data.fit.ppe.length > 0) {
          var ppeHtml = '';
          data.fit.ppe.forEach(function(p) {
            ppeHtml += '<tr><td>' + esc(p.ppeName) + '</td><td>' + esc(p.status) + '</td><td>' + esc(p.source) + '</td><td>' + esc(p.notes || '—') + '</td></tr>';
          });
          document.getElementById('ppeBody').innerHTML = ppeHtml;
        }
      }

      // TAB 3: Readiness
      if (data.readiness) {
        var overall = data.readiness.overallStatus || 'UNKNOWN';
        var overallEl = document.getElementById('readinessOverall');
        overallEl.textContent = overall;
        overallEl.className = 'badge badge-' + overall.toLowerCase();

        function renderGate(statusElId, reasonsElId, gate) {
          var statusEl = document.getElementById(statusElId);
          var reasonsEl = document.getElementById(reasonsElId);
          var status = gate.status || 'UNKNOWN';
          statusEl.textContent = status;
          statusEl.className = 'badge badge-' + status.toLowerCase();
          if (gate.reasons && gate.reasons.length > 0) {
            reasonsEl.innerHTML = gate.reasons.map(function(r) { return '<li>' + esc(r) + '</li>'; }).join('');
          } else {
            reasonsEl.innerHTML = '<li style="color:#888;font-style:italic;">No issues</li>';
          }
        }

        renderGate('hardBlockStatus', 'hardBlockReasons', data.readiness.hardBlock || {});
        renderGate('certGateStatus', 'certGateReasons', data.readiness.certGate || {});
        renderGate('complianceGateStatus', 'complianceGateReasons', data.readiness.complianceGate || {});
      }

      // TAB 4: Certifications
      if (data.certifications && data.certifications.length > 0) {
        var certsHtml = '';
        data.certifications.forEach(function(c) {
          var isExpired = c.expiresAt && new Date(c.expiresAt) < new Date();
          var expiresDisplay = c.expiresAt ? c.expiresAt.slice(0, 10) : '—';
          if (isExpired) expiresDisplay = '<span style="color:#b91c1c;font-weight:600;">' + expiresDisplay + ' (EXPIRED)</span>';
          certsHtml += '<tr>' +
            '<td>' + esc(c.certName) + '</td>' +
            '<td>' + esc(c.certCode) + '</td>' +
            '<td>' + esc(c.status) + '</td>' +
            '<td>' + esc(c.verification) + '</td>' +
            '<td>' + (c.issuedAt ? c.issuedAt.slice(0, 10) : '—') + '</td>' +
            '<td>' + expiresDisplay + '</td>' +
            '</tr>';
        });
        document.getElementById('certsBody').innerHTML = certsHtml;
      }

      // TAB 5: Compliance
      if (data.compliance) {
        document.getElementById('complianceI9').textContent = data.compliance.i9Status || 'Not available';
        document.getElementById('complianceW4').textContent = data.compliance.w4Status || 'Not available';
        document.getElementById('complianceBackground').textContent = data.compliance.backgroundCheckStatus || 'Not available';
        document.getElementById('complianceDrug').textContent = data.compliance.drugScreenStatus || 'Not available';
      }

      // TAB 6: Notes & History
      if (data.notesHistory) {
        if (data.notesHistory.notes && data.notesHistory.notes.length > 0) {
          document.getElementById('notesPlaceholder').style.display = 'none';
          document.getElementById('notesList').style.display = 'block';
          // Future: render notes here
        } else {
          document.getElementById('notesPlaceholder').textContent = data.notesHistory.placeholder || 'No notes available';
        }
      }

      // TAB 7: Documents
      if (data.documents) {
        if (data.documents.documents && data.documents.documents.length > 0) {
          document.getElementById('documentsPlaceholder').style.display = 'none';
          document.getElementById('documentsList').style.display = 'block';
          // Future: render documents here
        } else {
          document.getElementById('documentsPlaceholder').textContent = data.documents.placeholder || 'No documents available';
        }
      }

      function esc(str) {
        if (str === null || str === undefined) return '';
        var div = document.createElement('div');
        div.appendChild(document.createTextNode(String(str)));
        return div.innerHTML;
      }
    })();
  </script>
</body>
</html>

