<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audit History â€“ UI-13</title>

  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --border: #e2e8f0;
      --text: #1f2937;
      --muted: #64748b;

      --purple: #7c3aed;
      --green: #16a34a;
      --red: #dc2626;
      --amber: #d97706;
      --blue: #2563eb;

      --radius: 10px;
      --shadow: 0 6px 20px rgba(0,0,0,.08);
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 1rem;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #6d28d9, #8b5cf6);
      color: #fff;
      padding: 1rem 1.25rem;
      border-radius: var(--radius) var(--radius) 0 0;
      font-weight: 600;
      letter-spacing: .2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-badge {
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.6rem;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .card {
      background: var(--card);
      border-radius: 0 0 var(--radius) var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem;
    }

    .section {
      margin-bottom: 1.25rem;
    }

    .label {
      font-size: .65rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--muted);
      margin-bottom: .25rem;
      font-weight: 600;
    }

    .value {
      font-size: .9rem;
      font-weight: 600;
    }

    .mono {
      font-family: var(--mono);
      font-size: .82rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: .75rem 1.25rem;
    }

    .badge {
      display: inline-block;
      padding: .25rem .55rem;
      font-size: .65rem;
      font-weight: 700;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: .04em;
    }

    .badge.green { background: #dcfce7; color: #166534; }
    .badge.red { background: #fee2e2; color: #991b1b; }
    .badge.amber { background: #fffbeb; color: #92400e; }
    .badge.purple { background: #ede9fe; color: #5b21b6; }
    .badge.gray { background: #f1f5f9; color: #475569; }
    .badge.blue { background: #dbeafe; color: #1e40af; }

    .divider {
      border-top: 1px solid var(--border);
      margin: 1.25rem 0;
    }

    .alert {
      padding: .75rem;
      border-radius: 8px;
      font-size: .85rem;
      margin-bottom: 1rem;
    }

    .alert.error { background: #fee2e2; color: #991b1b; }
    .alert.success { background: #dcfce7; color: #166534; }
    .alert.info { background: #eff6ff; color: #1e40af; }

    .placeholder {
      text-align: center;
      padding: 2.5rem 1rem;
      color: var(--muted);
      font-size: .9rem;
    }

    /* Read-only banner */
    .readonly-banner {
      background: linear-gradient(90deg, #dbeafe, #e0e7ff);
      border: 1px solid #93c5fd;
      border-radius: 8px;
      padding: 0.6rem 0.9rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: #1e40af;
    }

    .readonly-banner .icon {
      font-size: 1rem;
    }

    /* Export links */
    .export-links {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .export-link {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.4rem 0.7rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      text-decoration: none;
      background: #f1f5f9;
      color: #475569;
      border: 1px solid var(--border);
      transition: background 0.15s;
    }

    .export-link:hover {
      background: #e2e8f0;
    }

    /* Audit table */
    .audit-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
    }

    .audit-table thead th {
      background: #f1f5f9;
      padding: 0.6rem 0.5rem;
      text-align: left;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      border-bottom: 2px solid var(--border);
    }

    .audit-table tbody tr {
      border-bottom: 1px solid var(--border);
    }

    .audit-table tbody tr:hover {
      background: #f8fafc;
    }

    .audit-table tbody td {
      padding: 0.6rem 0.5rem;
      vertical-align: top;
    }

    .audit-table .action-cell {
      font-weight: 700;
    }

    .audit-table .action-cell.approve { color: var(--green); }
    .audit-table .action-cell.reject { color: var(--red); }
    .audit-table .action-cell.hold { color: var(--amber); }

    .audit-table .status-transition {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.75rem;
    }

    .audit-table .status-transition .arrow {
      color: var(--muted);
    }

    .audit-table .reason-cell {
      max-width: 200px;
      word-break: break-word;
      color: var(--muted);
      font-style: italic;
    }

    .audit-table .timestamp-cell {
      white-space: nowrap;
      color: var(--muted);
      font-size: 0.75rem;
    }

    .audit-table .user-cell {
      font-family: var(--mono);
      font-size: 0.72rem;
    }

    /* Summary stats */
    .summary-stats {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .stat-box {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.6rem 0.9rem;
      text-align: center;
      min-width: 80px;
    }

    .stat-box .stat-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--purple);
    }

    .stat-box .stat-label {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
      margin-top: 0.15rem;
    }

    .no-records {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
      font-style: italic;
    }

    /* Filter display */
    .active-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 1rem;
    }

    .filter-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      background: #ede9fe;
      color: #5b21b6;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <span>ðŸ“‹ Vetting Audit History</span>
      <span class="header-badge">Read Only</span>
    </div>
    <div class="card">

      <div id="alert"></div>

      <!-- Read-only banner -->
      <div class="readonly-banner">
        <span class="icon">ðŸ”’</span>
        <span><strong>Audit Log</strong> â€” This view is read-only. No modifications allowed.</span>
      </div>

      <div id="placeholder" class="placeholder">
        Provide <code>orderId</code> and <code>employeeId</code> to view audit history.
      </div>

      <div id="content" style="display:none">

        <!-- Context -->
        <div class="section">
          <div class="grid">
            <div>
              <div class="label">Order ID</div>
              <div class="value mono" id="orderId"></div>
            </div>
            <div>
              <div class="label">Employee ID</div>
              <div class="value mono" id="employeeId"></div>
            </div>
          </div>
        </div>

        <!-- Active filters display -->
        <div id="filtersSection" class="active-filters" style="display:none"></div>

        <!-- Export links -->
        <div id="exportLinks" class="export-links">
          <a id="jsonLink" class="export-link" href="#">
            <span>{ }</span> Export JSON
          </a>
          <a id="csvLink" class="export-link" href="#">
            <span>ðŸ“„</span> Export CSV
          </a>
        </div>

        <!-- Summary stats -->
        <div class="summary-stats">
          <div class="stat-box">
            <div class="stat-value" id="totalRecords">0</div>
            <div class="stat-label">Total Records</div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Audit table -->
        <div id="tableContainer">
          <table class="audit-table">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Action</th>
                <th>Status Change</th>
                <th>Reason</th>
                <th>User</th>
              </tr>
            </thead>
            <tbody id="auditTableBody">
            </tbody>
          </table>
        </div>

        <div id="noRecords" class="no-records" style="display:none">
          No audit records found for this candidate.
        </div>

      </div>
    </div>
  </div>

  <script>
    (function () {
      if (!window.__DATA__) return;

      const d = window.__DATA__;

      // Handle errors
      if (d.error || d.errorMessage) {
        document.getElementById('alert').innerHTML =
          '<div class="alert error">' + (d.errorMessage || 'An error occurred') + '</div>';
        return;
      }

      // If no data, keep placeholder
      if (!d.orderId || !d.employeeId) {
        return;
      }

      document.getElementById('placeholder').style.display = 'none';
      document.getElementById('content').style.display = 'block';

      // Populate context
      document.getElementById('orderId').textContent = d.orderId;
      document.getElementById('employeeId').textContent = d.employeeId;

      // Summary stats
      document.getElementById('totalRecords').textContent = d.totalRecords || 0;

      // Export links
      const baseUrl = '/ui/internal/ui13/audit-history?orderId=' + encodeURIComponent(d.orderId) +
                      '&employeeId=' + encodeURIComponent(d.employeeId);
      document.getElementById('jsonLink').href = baseUrl + '&format=json';
      document.getElementById('csvLink').href = baseUrl + '&format=csv';

      // Active filters
      if (d.filters) {
        const filtersSection = document.getElementById('filtersSection');
        let hasFilters = false;

        if (d.filters.action) {
          filtersSection.innerHTML += '<span class="filter-tag">Action: ' + d.filters.action + '</span>';
          hasFilters = true;
        }
        if (d.filters.userId) {
          filtersSection.innerHTML += '<span class="filter-tag">User: ' + d.filters.userId + '</span>';
          hasFilters = true;
        }
        if (d.filters.startDate) {
          filtersSection.innerHTML += '<span class="filter-tag">From: ' + d.filters.startDate + '</span>';
          hasFilters = true;
        }
        if (d.filters.endDate) {
          filtersSection.innerHTML += '<span class="filter-tag">To: ' + d.filters.endDate + '</span>';
          hasFilters = true;
        }

        if (hasFilters) {
          filtersSection.style.display = 'flex';
        }
      }

      // Populate audit table
      const tbody = document.getElementById('auditTableBody');
      const audits = d.audits || [];

      if (audits.length === 0) {
        document.getElementById('tableContainer').style.display = 'none';
        document.getElementById('noRecords').style.display = 'block';
        return;
      }

      for (const a of audits) {
        const tr = document.createElement('tr');

        // Timestamp
        const tdTime = document.createElement('td');
        tdTime.className = 'timestamp-cell';
        tdTime.textContent = formatDate(a.createdAt);
        tr.appendChild(tdTime);

        // Action
        const tdAction = document.createElement('td');
        tdAction.className = 'action-cell';
        tdAction.textContent = a.action;
        if (a.action === 'APPROVE') tdAction.classList.add('approve');
        else if (a.action === 'REJECT') tdAction.classList.add('reject');
        else if (a.action === 'HOLD') tdAction.classList.add('hold');
        tr.appendChild(tdAction);

        // Status change
        const tdStatus = document.createElement('td');
        tdStatus.innerHTML =
          '<div class="status-transition">' +
            '<span class="badge gray">' + a.previousStatus + '</span>' +
            '<span class="arrow">â†’</span>' +
            '<span class="badge ' + getStatusBadgeClass(a.newStatus) + '">' + a.newStatus + '</span>' +
          '</div>';
        tr.appendChild(tdStatus);

        // Reason
        const tdReason = document.createElement('td');
        tdReason.className = 'reason-cell';
        tdReason.textContent = a.reason || 'â€”';
        tr.appendChild(tdReason);

        // User
        const tdUser = document.createElement('td');
        tdUser.className = 'user-cell';
        tdUser.textContent = a.performedByUserId;
        tr.appendChild(tdUser);

        tbody.appendChild(tr);
      }

      function formatDate(dateStr) {
        if (!dateStr) return 'â€”';
        try {
          const d = new Date(dateStr);
          return d.toLocaleString();
        } catch (e) {
          return dateStr;
        }
      }

      function getStatusBadgeClass(status) {
        if (status === 'APPROVED') return 'green';
        if (status === 'REJECTED') return 'red';
        if (status === 'VETTING_HOLD') return 'amber';
        if (status === 'PENDING' || status === 'VETTING_PENDING') return 'purple';
        return 'gray';
      }
    })();
  </script>
</body>
</html>

